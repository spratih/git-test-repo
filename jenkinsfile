pipeline {
    agent any
    stages {
        stage('source code') {
            steps {
                     git branch: 'master', credentialsId: 'jenkins', url: 'ssh://git@github.com:spratih/git-test-repo.git'
                     sh ''' presentdate=`date +'%s'`'
                     sh '''list_of_branches=$(curl -s -u $user_name:$password https://api.github.com/repos/$user_name/$url/branches | grep 'name' | awk '{print $2}')'''
                     sh '''for branch in "{$list_of_branches}"; do'''
                     sh '''api_branch_name=$(echo "$branch" | cut -d'"' -f 2)'''
                     sh '''last_updated_date=$(curl -s -u $user_name:$password https://api.github.com/repos/$user_name/$url/branches/$api_branch_name | grep 'date'| awk '{print $2}'| sed '$d')'''
                     sh '''api_last_updated_date=$(echo $last_updated_date | cut -d'"' -f 2)'''
                     sh '''last_updated_date_sec=$(date -d $api_last_updated_date +%s)'''
                     sh '''numberofdays=$(( ($presentdate - $last_updated_date_sec)/(60*60*24) ))'''
                     if ( "$numberofdays" > "1") {
                     echo "Branch $api_branch_name is updated $numberofdays days back"
                     }              
                }
            }
        }
    }
